<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite MEV Bot v2.1 Ultra Speed Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #ffffff;
            overflow-x: hidden;
        }

        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem 2rem;
            border-bottom: 2px solid #00ff88;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #00ff88;
            font-size: 2rem;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff88;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            padding: 2rem;
            max-width: 1800px;
            margin: 0 auto;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.2);
        }

        .metric-card h3 {
            color: #00ff88;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            border-bottom: 1px solid rgba(0, 255, 136, 0.3);
            padding-bottom: 0.5rem;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            margin: 0.5rem 0;
            padding: 0.3rem 0;
        }

        .metric-label {
            color: #cccccc;
        }

        .metric-value {
            color: #ffffff;
            font-weight: bold;
        }

        .metric-value.success {
            color: #00ff88;
        }

        .metric-value.warning {
            color: #ffaa00;
        }

        .metric-value.danger {
            color: #ff4444;
        }

        .chart-container {
            height: 200px;
            margin-top: 1rem;
        }

        .large-chart {
            grid-column: span 2;
            height: 400px;
        }

        .emergency-controls {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid rgba(255, 68, 68, 0.5);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }

        .emergency-btn {
            background: linear-gradient(45deg, #ff4444, #cc0000);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0.5rem;
        }

        .emergency-btn:hover {
            background: linear-gradient(45deg, #cc0000, #aa0000);
            transform: scale(1.05);
        }

        .config-btn {
            background: linear-gradient(45deg, #0088ff, #0066cc);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0.2rem;
        }

        .config-btn:hover {
            background: linear-gradient(45deg, #0066cc, #004499);
            transform: scale(1.05);
        }

        .latency-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .latency-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #ffaa00, #ff4444);
            transition: width 0.3s ease;
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 20px;
            border: 1px solid #00ff88;
            font-size: 0.9rem;
        }

        .log-console {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            padding: 1rem;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            white-space: pre-wrap;
        }

        .log-entry {
            margin: 2px 0;
        }

        .log-error { color: #ff4444; }
        .log-warn { color: #ffaa00; }
        .log-info { color: #00ff88; }
        .log-debug { color: #cccccc; }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
                padding: 1rem;
            }

            .large-chart {
                grid-column: span 1;
            }

            .header h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ Elite MEV Bot v2.1 Ultra Speed</h1>
        <div class="status-indicator">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">Connecting...</span>
        </div>
    </div>

    <div class="connection-status" id="connectionStatus">
        Connecting to dashboard...
    </div>

    <div class="dashboard-grid">
        <!-- Latency Metrics -->
        <div class="metric-card">
            <h3>‚ö° Latency Metrics</h3>
            <div class="metric-row">
                <span class="metric-label">ShredStream:</span>
                <span class="metric-value" id="shredstreamLatency">0.0ms</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Detection:</span>
                <span class="metric-value" id="detectionLatency">0.0ms</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Execution:</span>
                <span class="metric-value" id="executionLatency">0.0ms</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Total Pipeline:</span>
                <span class="metric-value" id="totalLatency">0.0ms</span>
            </div>
            <div class="latency-bar">
                <div class="latency-fill" id="latencyBar" style="width: 0%"></div>
            </div>
            <div class="metric-row">
                <span class="metric-label">Target: 15.0ms</span>
                <span class="metric-value" id="latencyStatus">üéØ</span>
            </div>
        </div>

        <!-- Trading Performance -->
        <div class="metric-card">
            <h3>üí∞ Trading Performance</h3>
            <div class="metric-row">
                <span class="metric-label">Total Trades:</span>
                <span class="metric-value" id="totalTrades">0</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Success Rate:</span>
                <span class="metric-value" id="winRate">0%</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Total Profit:</span>
                <span class="metric-value success" id="totalProfit">0.000 SOL</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Avg Profit/Trade:</span>
                <span class="metric-value" id="avgProfit">0.000 SOL</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Trades/Min:</span>
                <span class="metric-value" id="tradesPerMin">0.0</span>
            </div>
        </div>

        <!-- System Health -->
        <div class="metric-card">
            <h3>üè• System Health</h3>
            <div class="metric-row">
                <span class="metric-label">ShredStream:</span>
                <span class="metric-value" id="shredstreamStatus">Unknown</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Backup gRPC:</span>
                <span class="metric-value" id="grpcStatus">Unknown</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Jito MEV:</span>
                <span class="metric-value" id="jitoStatus">Unknown</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Error Rate:</span>
                <span class="metric-value" id="errorRate">0.0%</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Uptime:</span>
                <span class="metric-value" id="uptime">0s</span>
            </div>
        </div>

        <!-- Performance Metrics -->
        <div class="metric-card">
            <h3>‚öôÔ∏è Performance</h3>
            <div class="metric-row">
                <span class="metric-label">CPU Usage:</span>
                <span class="metric-value" id="cpuUsage">0.0%</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Memory Usage:</span>
                <span class="metric-value" id="memoryUsage">0 MB</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Network:</span>
                <span class="metric-value" id="networkThroughput">0.0 Mbps</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Cache Hit Rate:</span>
                <span class="metric-value" id="cacheHitRate">0.0%</span>
            </div>
        </div>

        <!-- Latency Chart -->
        <div class="metric-card large-chart">
            <h3>üìä Real-time Latency Chart</h3>
            <div class="chart-container">
                <canvas id="latencyChart"></canvas>
            </div>
        </div>

        <!-- Profit Chart -->
        <div class="metric-card large-chart">
            <h3>üìà Profit Over Time</h3>
            <div class="chart-container">
                <canvas id="profitChart"></canvas>
            </div>
        </div>

        <!-- Emergency Controls -->
        <div class="emergency-controls">
            <h3>üö® Emergency Controls</h3>
            <button class="emergency-btn" onclick="emergencyStop()">
                EMERGENCY STOP
            </button>
            <button class="config-btn" onclick="resetMetrics()">
                Reset Metrics
            </button>
            <button class="config-btn" onclick="togglePaperTrading()">
                Toggle Paper Trading
            </button>
        </div>

        <!-- Live Console -->
        <div class="metric-card">
            <h3>üìù Live Console</h3>
            <div class="log-console" id="logConsole">
                <div class="log-entry log-info">Dashboard initialized...</div>
            </div>
        </div>
    </div>

    <script>
        class MEVDashboard {
            constructor() {
                this.ws = null;
                this.latencyData = [];
                this.profitData = [];
                this.maxDataPoints = 100;
                this.reconnectAttempts = 0;
                this.maxReconnectAttempts = 5;

                this.initializeCharts();
                this.connect();
            }

            connect() {
                const wsUrl = `ws://${window.location.hostname}:8080`;
                this.ws = new WebSocket(wsUrl);

                this.ws.onopen = () => {
                    this.log('Connected to MEV Bot dashboard', 'info');
                    this.updateConnectionStatus('Connected', 'success');
                    this.reconnectAttempts = 0;
                };

                this.ws.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        this.handleMessage(data);
                    } catch (error) {
                        this.log(`Error parsing message: ${error}`, 'error');
                    }
                };

                this.ws.onclose = () => {
                    this.log('Disconnected from dashboard', 'warn');
                    this.updateConnectionStatus('Disconnected', 'error');
                    this.attemptReconnect();
                };

                this.ws.onerror = (error) => {
                    this.log(`WebSocket error: ${error}`, 'error');
                };
            }

            attemptReconnect() {
                if (this.reconnectAttempts < this.maxReconnectAttempts) {
                    this.reconnectAttempts++;
                    this.log(`Attempting to reconnect (${this.reconnectAttempts}/${this.maxReconnectAttempts})...`, 'warn');
                    setTimeout(() => this.connect(), 2000 * this.reconnectAttempts);
                } else {
                    this.log('Max reconnection attempts reached', 'error');
                    this.updateConnectionStatus('Connection Failed', 'error');
                }
            }

            handleMessage(data) {
                switch (data.type) {
                    case 'welcome':
                        this.log(data.message, 'info');
                        break;
                    case 'metrics_update':
                        this.updateMetrics(data.data);
                        break;
                    default:
                        this.log(`Unknown message type: ${data.type}`, 'debug');
                }
            }

            updateMetrics(metrics) {
                // Update latency metrics
                const latency = metrics.latency_metrics;
                document.getElementById('shredstreamLatency').textContent = `${latency.shredstream_latency_ms.toFixed(2)}ms`;
                document.getElementById('detectionLatency').textContent = `${latency.detection_latency_ms.toFixed(2)}ms`;
                document.getElementById('executionLatency').textContent = `${latency.execution_latency_ms.toFixed(2)}ms`;
                document.getElementById('totalLatency').textContent = `${latency.total_pipeline_latency_ms.toFixed(2)}ms`;

                // Update latency bar
                const latencyPercent = Math.min((latency.total_pipeline_latency_ms / latency.target_latency_ms) * 100, 100);
                document.getElementById('latencyBar').style.width = `${latencyPercent}%`;

                const latencyStatus = latency.total_pipeline_latency_ms <= latency.target_latency_ms ? 'üéØ' : '‚ö†Ô∏è';
                document.getElementById('latencyStatus').textContent = latencyStatus;

                // Update trading metrics
                const trading = metrics.trading_metrics;
                document.getElementById('totalTrades').textContent = trading.total_trades;
                document.getElementById('winRate').textContent = `${trading.win_rate.toFixed(1)}%`;
                document.getElementById('totalProfit').textContent = `${trading.total_profit_sol.toFixed(3)} SOL`;
                document.getElementById('avgProfit').textContent = `${trading.average_profit_per_trade.toFixed(3)} SOL`;
                document.getElementById('tradesPerMin').textContent = trading.trades_per_minute.toFixed(1);

                // Update health metrics
                const health = metrics.health_metrics;
                this.updateStatusElement('shredstreamStatus', health.shredstream_status);
                this.updateStatusElement('grpcStatus', health.backup_grpc_status);
                this.updateStatusElement('jitoStatus', health.jito_status);
                document.getElementById('errorRate').textContent = `${health.error_rate.toFixed(1)}%`;
                document.getElementById('uptime').textContent = this.formatUptime(health.uptime_seconds);

                // Update performance metrics
                const performance = metrics.performance_metrics;
                document.getElementById('cpuUsage').textContent = `${performance.cpu_usage_percent.toFixed(1)}%`;
                document.getElementById('memoryUsage').textContent = `${performance.memory_usage_mb.toFixed(0)} MB`;
                document.getElementById('networkThroughput').textContent = `${performance.network_throughput_mbps.toFixed(1)} Mbps`;
                document.getElementById('cacheHitRate').textContent = `${performance.cache_hit_rate.toFixed(1)}%`;

                // Update charts
                this.updateCharts(metrics);
            }

            updateStatusElement(elementId, status) {
                const element = document.getElementById(elementId);
                element.textContent = status;
                element.className = 'metric-value';

                if (status.toLowerCase().includes('connected') || status.toLowerCase().includes('healthy')) {
                    element.classList.add('success');
                } else if (status.toLowerCase().includes('degraded') || status.toLowerCase().includes('warning')) {
                    element.classList.add('warning');
                } else if (status.toLowerCase().includes('disconnected') || status.toLowerCase().includes('error')) {
                    element.classList.add('danger');
                }
            }

            updateConnectionStatus(status, type) {
                const statusElement = document.getElementById('connectionStatus');
                const statusDot = document.getElementById('statusDot');
                const statusText = document.getElementById('statusText');

                statusElement.textContent = `Dashboard: ${status}`;
                statusText.textContent = status;

                statusDot.style.background = type === 'success' ? '#00ff88' :
                                           type === 'warning' ? '#ffaa00' : '#ff4444';
            }

            formatUptime(seconds) {
                const days = Math.floor(seconds / 86400);
                const hours = Math.floor((seconds % 86400) / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);

                if (days > 0) return `${days}d ${hours}h ${minutes}m`;
                if (hours > 0) return `${hours}h ${minutes}m`;
                return `${minutes}m ${seconds % 60}s`;
            }

            initializeCharts() {
                // Latency Chart
                const latencyCtx = document.getElementById('latencyChart').getContext('2d');
                this.latencyChart = new Chart(latencyCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Total Latency (ms)',
                            data: [],
                            borderColor: '#00ff88',
                            backgroundColor: 'rgba(0, 255, 136, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 50,
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#ffffff' }
                            },
                            x: {
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#ffffff', maxTicksLimit: 10 }
                            }
                        },
                        plugins: {
                            legend: { labels: { color: '#ffffff' } }
                        }
                    }
                });

                // Profit Chart
                const profitCtx = document.getElementById('profitChart').getContext('2d');
                this.profitChart = new Chart(profitCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Profit (SOL)',
                            data: [],
                            borderColor: '#ffaa00',
                            backgroundColor: 'rgba(255, 170, 0, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#ffffff' }
                            },
                            x: {
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#ffffff', maxTicksLimit: 10 }
                            }
                        },
                        plugins: {
                            legend: { labels: { color: '#ffffff' } }
                        }
                    }
                });
            }

            updateCharts(metrics) {
                const now = new Date().toLocaleTimeString();

                // Update latency chart
                this.latencyChart.data.labels.push(now);
                this.latencyChart.data.datasets[0].data.push(metrics.latency_metrics.total_pipeline_latency_ms);

                if (this.latencyChart.data.labels.length > this.maxDataPoints) {
                    this.latencyChart.data.labels.shift();
                    this.latencyChart.data.datasets[0].data.shift();
                }
                this.latencyChart.update('none');

                // Update profit chart
                this.profitChart.data.labels.push(now);
                this.profitChart.data.datasets[0].data.push(metrics.trading_metrics.total_profit_sol);

                if (this.profitChart.data.labels.length > this.maxDataPoints) {
                    this.profitChart.data.labels.shift();
                    this.profitChart.data.datasets[0].data.shift();
                }
                this.profitChart.update('none');
            }

            sendCommand(command) {
                if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                    this.ws.send(JSON.stringify(command));
                    this.log(`Sent command: ${command.type}`, 'info');
                } else {
                    this.log('Cannot send command: Not connected', 'error');
                }
            }

            log(message, level = 'info') {
                const console = document.getElementById('logConsole');
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry log-${level}`;
                logEntry.textContent = `[${timestamp}] ${message}`;

                console.appendChild(logEntry);
                console.scrollTop = console.scrollHeight;

                // Keep only last 100 log entries
                while (console.children.length > 100) {
                    console.removeChild(console.firstChild);
                }
            }
        }

        // Global functions for buttons
        function emergencyStop() {
            dashboard.sendCommand({ type: 'emergency_stop' });
        }

        function resetMetrics() {
            dashboard.sendCommand({ type: 'reset_metrics' });
        }

        function togglePaperTrading() {
            dashboard.sendCommand({ type: 'toggle_paper_trading' });
        }

        // Initialize dashboard
        const dashboard = new MEVDashboard();
    </script>
</body>
</html>